---
  parameters:
  - name: appname
    default: demo
  - name: instance_type
    default: t2.xlarge
  - name: runner_size
    default: t2.micro
  - name: vpc
    cloudtype: AWS::EC2::VPC::Id
    default: <%= MU.myVPC %>

# BEGIN APPLICATION DEFINITION
  appname: <%= appname %>
  servers: 
    - 
      name: gitlab
      size: <%= instance_type %>
      platform: ubuntu
      storage:
      -
        size: 16
      skipinitialupdates: true
      associate_public_ip: true
      run_list:
        - recipe[demo::gitlab]
        - recipe[demo::gitlab_runner]
      vpc:
        vpc_id: <%= vpc %>
        subnet_pref: public
      ingress_rules:
      -
        port: 443
        hosts:
          - "0.0.0.0/0"
      -
        port: 80
        hosts:
          - "0.0.0.0/0"
    - 
      name: gitlab-runner-D
      size: <%= runner_size %>
      platform: ubuntu
      storage:
      -
        size: 16
      skipinitialupdates: true
      run_list:
        - recipe[demo::gitlab_runner]
      vpc:
        vpc_id: <%= vpc %>
        subnet_pref: public
      dependencies:
      -
        name: "gitlab"
        phase: "groom"
        type: "server"
    # - 
    #   name: gitlab-runner-R
    #   size: <%= runner_size %>
    #   platform: centos
    #   storage:
    #   -
    #     size: 16
    #   skipinitialupdates: true
    #   run_list:
    #     - recipe[demo::gitlab_runner]
    #   vpc:
    #     vpc_id: <%= vpc %>
    #     subnet_pref: public
    #   dependencies:
    #   -
    #     name: "gitlab"
    #     phase: "groom"
    #     type: "server"